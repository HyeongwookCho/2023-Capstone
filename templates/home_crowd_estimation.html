<!doctype html>
<html lang="en">
  <head>
    
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SquareInPeople</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/album/">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
      iframe {
          width: 100%;
          height: 200px;
          border: none;
      }
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .b-example-divider {
        height: 3rem;
        background-color: rgba(0, 0, 0, .1);
        border: solid rgba(0, 0, 0, .15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
      }

      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }

      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }
    </style>

  </head>
  <body id="bootstrap-overrides">
    <nav class="navbar navbar-expand-lg bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" style="color : black" href="{% url 'detect:index' %}"><strong>CCTVAS</strong></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color : grey" href="{% url 'detect:home_foot_traffic' %}" onmouseover="this.style.color='black';" onmouseout="this.style.color='grey';">
                Foot Traffic
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <li><a class="dropdown-item" href="{% url 'detect:home_foot_traffic' %}">개요</a></li>
                <li><a class="dropdown-item" href="{% url 'detect:stream_traffic' %}">모델 구동</a></li>
                <li><a class="dropdown-item" href="{% url 'detect:foot_analysis' %}">유동인구 분석</a></li>
            </ul>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color : grey" href="{% url 'detect:home_crowd_estimation' %}" onmouseover="this.style.color='black';" onmouseout="this.style.color='grey';">
                Crowd Estimation
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <li><a class="dropdown-item" href="{% url 'detect:home_crowd_estimation' %}">개요</a></li>
                <li><a class="dropdown-item" href="{% url 'detect:stream_crowd' %}">모델 구동</a></li>
                <li><a class="dropdown-item" href="{% url 'detect:crowd_analysis' %}">인구밀집 분석</a></li>
              </ul>
            </li>
          </ul>


        </div>
      </div>
    </nav>
    <div class="b-example-divider"></div>
    
    <section>
      <div class="album py-5 bg-light">
        <div class="container">
    
          <div class="row row-cols-1 g-2">
              
            <div class="col">
            </div>
            <div class="col">
              
      <section>
      <header class="bg-light py-3">
        <div class="container">
          <h1 class="display-5 fw-bold">실시간 인구 밀집 분석 시스템</h1></p>
          <p class="mb-3">1. 해당 지역의 면적을 지도에서 계산합니다.</p>2. 면적 계산에 따라 인구 임계점을 제공받습니다.</p>3. 해당 인구 임계점을 영상에 적용하여 위험 알림을 받을 수 있습니다.</p></p>
        </div>
      </header>
      
        <div class="card-body">  
          <iframe src="{% url 'detect:set_stream_crowd' %}"></iframe>
        </div>
          <div class="album py-5 bg-light">
            <div class="container">
        
              <div class="row row-cols-1  g-2">
          
              <div class="col">
                </div>
                <div class="col">
                  <div class="card shadow-sm">
                    <style>
                      .info {position:relative;top:5px;left:5px;border-radius:6px;border: 1px solid #ccc;border-bottom:2px solid #ddd;font-size:12px;padding:5px;background:#fff;list-style:none;margin:0;} 
                      .info:nth-of-type(n) {border:0; box-shadow:0px 1px 2px #888;}    
                      .info .label {display:inline-block;width:50px;}
                      .number {font-weight:bold;color:#00a0e9;}  
                      </style>
                      </head>
                      <body>
                      <div id="map" style="width:100%;height:350px;"></div>  
                      <p>
                          <em>지도를 마우스로 클릭하면 다각형 그리기가 시작되고 <br>오른쪽 마우스를 클릭하면 다각형 그리기가 종료됩니다</em>   
                      </p> 
                        
                      <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=537bad074f77eca31a8ddd1262363265"></script>
                      <script>
                      var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
                          mapOption = { 
                              center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                              level: 3 // 지도의 확대 레벨
                          };
                      
                      var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
                      
                      var drawingFlag = false; // 다각형이 그려지고 있는 상태를 가지고 있을 변수입니다
                      var drawingPolygon; // 그려지고 있는 다각형을 표시할 다각형 객체입니다
                      var polygon; // 그리기가 종료됐을 때 지도에 표시할 다각형 객체입니다
                      var areaOverlay; // 다각형의 면적정보를 표시할 커스텀오버레이 입니다
                      
                      // 마우스 클릭 이벤트가 발생하고나면 drawingFlag가 그려지고 있는 상태인 ture 값으로 바뀝니다
                      // 그려지고 있는 상태인 경우 drawingPolygon 으로 그려지고 있는 다각형을 지도에 표시합니다
                      // 마우스 오른쪽 클릭 이벤트가 발생하면 drawingFlag가 그리기가 종료된 상태인 false 값으로 바뀌고
                      // polygon 으로 다 그려진 다각형을 지도에 표시합니다
                      
                      
                      // 지도에 마우스 클릭 이벤트를 등록합니다
                      // 지도를 클릭하면 다각형 그리기가 시작됩니다 그려진 다각형이 있으면 지우고 다시 그립니다
                      kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                      
                          // 마우스로 클릭한 위치입니다 
                          var clickPosition = mouseEvent.latLng; 
                          
                          // 지도 클릭이벤트가 발생했는데 다각형이 그려지고 있는 상태가 아니면
                          if (!drawingFlag) {
                      
                              // 상태를 true로, 다각형을 그리고 있는 상태로 변경합니다
                              drawingFlag = true;
                              
                              // 지도 위에 다각형이 표시되고 있다면 지도에서 제거합니다
                              if (polygon) {  
                                  polygon.setMap(null);      
                                  polygon = null;  
                              }
                              
                              // 지도 위에 면적정보 커스텀오버레이가 표시되고 있다면 지도에서 제거합니다
                              if (areaOverlay) {
                                  areaOverlay.setMap(null);
                                  areaOverlay = null;
                              }
                          
                              // 그려지고 있는 다각형을 표시할 다각형을 생성하고 지도에 표시합니다
                              drawingPolygon = new kakao.maps.Polygon({
                                  map: map, // 다각형을 표시할 지도입니다
                                  path: [clickPosition], // 다각형을 구성하는 좌표 배열입니다 클릭한 위치를 넣어줍니다
                                  strokeWeight: 3, // 선의 두께입니다 
                                  strokeColor: '#00a0e9', // 선의 색깔입니다
                                  strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
                                  strokeStyle: 'solid', // 선의 스타일입니다
                                  fillColor: '#00a0e9', // 채우기 색깔입니다
                                  fillOpacity: 0.2 // 채우기 불투명도입니다
                              }); 
                              
                              // 그리기가 종료됐을때 지도에 표시할 다각형을 생성합니다 
                              polygon = new kakao.maps.Polygon({ 
                                  path: [clickPosition], // 다각형을 구성하는 좌표 배열입니다 클릭한 위치를 넣어줍니다 
                                  strokeWeight: 3, // 선의 두께입니다 
                                  strokeColor: '#00a0e9', // 선의 색깔입니다   
                                  strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
                                  strokeStyle: 'solid', // 선의 스타일입니다
                                  fillColor: '#00a0e9', // 채우기 색깔입니다
                                  fillOpacity: 0.2 // 채우기 불투명도입니다
                              });
                      
                              
                          } else { // 다각형이 그려지고 있는 상태이면 
                              
                              // 그려지고 있는 다각형의 좌표에 클릭위치를 추가합니다
                              // 다각형의 좌표 배열을 얻어옵니다
                              var drawingPath = drawingPolygon.getPath();
                          
                              // 좌표 배열에 클릭한 위치를 추가하고
                              drawingPath.push(clickPosition);
                              
                              // 다시 다각형 좌표 배열을 설정합니다
                              drawingPolygon.setPath(drawingPath);
                               
                          
                              // 그리기가 종료됐을때 지도에 표시할 다각형의 좌표에 클릭 위치를 추가합니다
                              // 다각형의 좌표 배열을 얻어옵니다
                              var path = polygon.getPath();
                          
                              // 좌표 배열에 클릭한 위치를 추가하고
                              path.push(clickPosition);
                              
                              // 다시 다각형 좌표 배열을 설정합니다
                              polygon.setPath(path);
                          }
                      
                      });
                      
                      // 지도에 마우스무브 이벤트를 등록합니다
                      // 다각형을 그리고있는 상태에서 마우스무브 이벤트가 발생하면 그려질 다각형의 위치를 동적으로 보여주도록 합니다
                      kakao.maps.event.addListener(map, 'mousemove', function (mouseEvent) {
                      
                          // 지도 마우스무브 이벤트가 발생했는데 다각형을 그리고있는 상태이면
                          if (drawingFlag){
                      
                              // 마우스 커서의 현재 위치를 얻어옵니다 
                              var mousePosition = mouseEvent.latLng; 
                              
                              // 그려지고있는 다각형의 좌표배열을 얻어옵니다
                              var path = drawingPolygon.getPath();
                              
                              // 마우스무브로 추가된 마지막 좌표를 제거합니다
                              if (path.length > 1) {
                                  path.pop();
                              } 
                              
                              // 마우스의 커서 위치를 좌표 배열에 추가합니다
                              path.push(mousePosition);
                      
                              // 그려지고 있는 다각형의 좌표를 다시 설정합니다
                              drawingPolygon.setPath(path);
                          }             
                      });   
                    
                      // 지도에 마우스 오른쪽 클릭 이벤트를 등록합니다
                      // 다각형을 그리고있는 상태에서 마우스 오른쪽 클릭 이벤트가 발생하면 그리기를 종료합니다
                      
                      kakao.maps.event.addListener(map, 'rightclick',  function (mouseEvent) {
                      
                          // 지도 오른쪽 클릭 이벤트가 발생했는데 다각형을 그리고있는 상태이면
                          if (drawingFlag) {
                              
                              // 그려지고있는 다각형을  지도에서 제거합니다
                              drawingPolygon.setMap(null);
                              drawingPolygon = null;  
                              
                              // 클릭된 죄표로 그릴 다각형의 좌표배열을 얻어옵니다
                              var path = polygon.getPath();
                          
                              // 다각형을 구성하는 좌표의 개수가 3개 이상이면 
                              if (path.length > 2) {
                                  
                                  // 지도에 다각형을 표시합니다
                                  polygon.setMap(map); 
                      
                                  var area = Math.round(polygon.getArea()), // 다각형의 총면적을 계산합니다
                                      content = '<div class="info">총면적 <span class="number"> ' + area + '</span> m<sup>2</sup></div>'; // 커스텀오버레이에 추가될 내용입니다
                                  
                                   // 1m^2 당 인원 수를 기준
                                  // 이 이상이 되면 매우 위험해진다.
                                  var multipliedArea1 = area * 5; 
                                  var content2 = '<div class="info">1m<sup>2</sup> 당 5명 - 위험 : <span class="number"> ' + multipliedArea1 + '</span> 명</sup></div>';
                                  // 위험을 미리 대비해야 되는 상황 더 증가한다면 위험
                                  var multipliedArea2 = area * 4; 
                                  var content3 = '<div class="info">1m<sup>2</sup> 당 4명 - 혼잡 : <span class="number"> ' + multipliedArea2 + '</span> 명</sup></div>';
                                  // 충분히 많은 사람들이 돌아다니는 상황
                                  var multipliedArea3 = area * 3; 
                                  var content4 = '<div class="info">1m<sup>2</sup> 당 3명 - 안전 : <span class="number"> ' + multipliedArea3 + '</span> 명</sup></div>';
                                  
                                  // 해당 내용을 한 텍스트로 결합
                                  var combinedContent = content + content2 + content3 + content4;
                                  
                                  // 면적정보를 지도에 표시합니다
                                  areaOverlay = new kakao.maps.CustomOverlay({
                                      map: map, // 커스텀오버레이를 표시할 지도입니다 
                                      content: combinedContent,  // 커스텀오버레이에 표시할 내용입니다                                   
                                      xAnchor: 0,
                                      yAnchor: 0,
                                      position: path[path.length-1]  // 커스텀오버레이를 표시할 위치입니다. 위치는 다각형의 마지막 좌표로 설정합니다
                                  });                                
                                   
                              } else { 
                                  
                                  // 다각형을 구성하는 좌표가 2개 이하이면 다각형을 지도에 표시하지 않습니다 
                                  polygon = null;  
                              }
                              
                              // 상태를 false로, 그리지 않고 있는 상태로 변경합니다
                              drawingFlag = false;    
                             
                          }  
                      });
                        
                      </script>
                    
                  </div>
                </div>
                  </div>
                </div>
                </div>
        </section>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
      
  </body>
</html>